<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Khóa học Tổng Ôn</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/4.1.1/animate.min.css" />
    <link rel="stylesheet" href="styles.css" />
</head>

<body class="">
    <!-- Theme Toggle Button -->
    <button id="theme-toggle" title="Chuyển đổi chủ đề" aria-label="Chuyển đổi giữa chế độ sáng và tối" class="flex items-center justify-center w-12 h-12 bg-gray-800 text-white rounded-full shadow-lg transition-all duration-300 hover:scale-110 hover:bg-gray-700">
        <i class="fas fa-moon text-lg hidden" id="dark-icon"></i>
        <i class="fas fa-sun text-lg hidden" id="light-icon"></i>
    </button>

    <!-- Scroll to Top Button -->
    <button id="scroll-to-top" title="Lên đầu trang" aria-label="Cuộn lên đầu trang" class="flex items-center justify-center w-12 h-12 bg-gray-800 text-white rounded-full shadow-lg transition-all duration-300 hover:scale-110 hover:bg-gray-700">
        <i class="fas fa-arrow-up"></i>
    </button>

    <!-- Contact Bar -->
    <div class="contact-bar">
        <div class="contact-item">
            <a href="tel:326661401" target="_blank">
                <i class="fas fa-phone"></i>
            </a>
        </div>
        <div class="contact-item">
            <a href="http://zaloapp.com/qr/p/103b29ogmo8ml" target="_blank">
                <img src="https://img.icons8.com/color/48/000000/zalo.png" alt="Zalo">
            </a>
        </div>
        <div class="contact-item">
            <a href="https://www.facebook.com/tolavietdayahihi" target="_blank">
                <i class="fab fa-facebook"></i>
            </a>
        </div>
    </div>

    <!-- Header -->
        <header class="bg-primary sticky top-0 z-10">
        <div class="max-w-7xl mx-auto py-6 px-4 sm:px-6 lg:px-8 font-sans">
            <div class="flex flex-col space-y-4">
                <!-- Tiêu đề -->
                <h1 class="w-full text-center text-4xl font-bold text-accent">
                    <a href="index.html" class="hover:text-secondary transition-colors duration-300">Đinh Văn Phạm Việt</a>
                </h1>
                
                <!-- Thanh tìm kiếm và Hamburger -->
                <div class="flex items-center justify-center w-full">
                    <form id="search-form" class="w-full max-w-md flex items-center">
                        <input 
                            type="text" 
                            id="search-input" 
                            placeholder="Tìm kiếm bài giảng, đề thi..." 
                            class="w-full px-4 py-2 rounded-l-lg bg-card text-text-color focus:outline-none focus:ring-2 focus:ring-secondary border border-secondary"
                        >
                        <button 
                            type="submit" 
                            class="px-4 py-2 bg-secondary text-accent rounded-r-lg hover:bg-blue-500 transition-colors duration-300 border border-secondary border-l-0"
                        >
                            <i class="fas fa-search"></i>
                        </button>
                    </form>
                    <button id="hamburger" class="ml-4 text-accent hover:text-secondary" aria-label="Mở menu">
                        <i class="fas fa-bars"></i>
                    </button>
                </div>
            </div>
        </div>
        
        <!-- Menu Mobile -->
        <div id="mobile-menu" class="mobile-menu">
            <a href="Daiso.html">Đại số</a>
            <a href="Hinhhoc.html">Hình học</a>
            <a href="Thongkexacsuat.html">Thống kê Xác suất</a>
            <a href="Tongon.html">Tổng ôn</a>
            <a href="Giaide.html">Giải đề</a>
        </div>
        <div id="overlay"></div>
    </header>

        <div class="container mx-auto px-4 py-6 max-w-6xl">
            <div class="bg-gray-100 border-white rounded-md px-4 py-2 mb-6">
        <div class="flex items-center space-x-2 text-sm">
                <a href="index.html" class="font-medium text-gray-800 hover:underline">TRANG CHỦ</a>
                <span class="text-gray-800">></span>
                <span class="font-medium text-gray-800">ĐẠI SỐ</span>
            </div>
        </div>

        <!-- Course Header with YouTube Video -->
        <div class="card rounded-lg shadow-md overflow-hidden mb-6">
            <!-- Video Type Selector -->
            <div class="flex border-b" id="video-type-selector">
                <button id="main-lesson-btn" class="video-type-btn flex-1 py-2 font-medium active" data-type="main">
                    <i class="fas fa-chalkboard-teacher mr-2"></i>Bài giảng chính
                </button>
                <button id="exercise-btn" class="video-type-btn flex-1 py-2 font-medium" data-type="exercise">
                    <i class="fas fa-tasks mr-2"></i>Chữa bài tập
                </button>
            </div>
            
            <!-- YouTube Video Embed -->
            <div class="video-container">
                <div id="video-loading" class="video-loading hidden">
                    <div class="spinner"></div>
                </div>
                <iframe 
                    id="course-video"
                    class="w-full h-full" 
                    src="https://www.youtube.com/embed/LWw1GYTMvjQ?autoplay=1&rel=0&modestbranding=1&controls=1&fs=1&disablekb=1&iv_load_policy=3" 
                    title="Giới thiệu khóa học Đại Số" 
                    frameborder="0" 
                    allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" 
                    allowfullscreen>
                </iframe>
            </div>
            
            <!-- Video Info -->
            <div class="p-6">
                <h1 id="course-title" class="text-2xl font-bold mb-3 title-transition">ĐẠI SỐ</h1>
                <h2 id="chapter-theme-title" class="text-lg font-semibold mb-3 title-transition hidden"></h2>
                <h3 id="video-type-title" class="text-md font-medium mb-3 text-blue-300 hidden"></h3>
                
                <div class="flex flex-wrap items-center justify-between gap-4">
                    <div class="flex items-center">
                        <div class="w-10 h-10 rounded-full bg-gray-300 flex items-center justify-center mr-3">
                            <i class="fas fa-user text-gray-600"></i>
                        </div>
                        <span>Đinh Việt</span>
                    </div>

                    <!--
                    <div class="flex space-x-2">
                        <button class="bg-blue-100 px-4 py-2 rounded-md text-sm font-medium">
                            <i class="fas fa-volume-up mr-2"></i>Nhấn để bật tiếng
                        </button>
                        <button class="bg-gray-100 px-4 py-2 rounded-md text-sm font-medium">
                            <i class="fas fa-share-alt mr-2"></i>Chia sẻ
                        </button>
                    </div>
                    -->
                </div>
            </div>
        </div>

        <!-- Tabs -->
        <div class="flex border-b mb-6">
            <button id="description-tab" class="tab-button px-4 py-2 font-medium border-b-2 border-blue-800 text-blue-800" data-target="description-content">
                Mô tả khóa học
            </button>
            <button id="curriculum-tab" class="tab-button px-4 py-2 font-medium text-gray-500" data-target="curriculum-content">
                Đề cương khóa học
            </button>
        </div>

        <!-- Course Description Content (Initially visible) -->
        <div id="description-content" class="tab-content card rounded-lg shadow-md p-6 mb-6">
            <h2 class="text-xl font-bold mb-4">Mô tả khóa học</h2>
            <div class="prose max-w-none">
                <p class="mb-4">Khóa học <span class="font-semibold">Đại Số - STEP 1. START UP</span> cung cấp nền tảng vững chắc về các khái niệm đại số cơ bản, giúp học sinh làm quen với phương pháp tư duy toán học hiện đại.</p>
                
                <h3 class="text-lg font-semibold mt-6 mb-2">Đối tượng học sinh:</h3>
                <ul class="list-disc pl-6 mb-4">
                    <li>Học sinh lớp 10-12 mới bắt đầu học đại số</li>
                    <li>Học sinh cần ôn tập kiến thức nền tảng</li>
                    <li>Học sinh chuẩn bị cho kỳ thi THPT Quốc gia</li>
                </ul>

                <h3 class="text-lg font-semibold mt-6 mb-2">Nội dung chính:</h3>
                <ul class="list-disc pl-6 mb-4">
                    <li>Hiểu bản chất các khái niệm đại số</li>
                    <li>Phương pháp giải toán từ cơ bản đến nâng cao</li>
                    <li>Hệ thống bài tập phân loại rõ ràng</li>
                    <li>Kỹ thuật giải nhanh bằng máy tính Casio</li>
                </ul>

                <div class="bg-yellow-50 border-l-4 p-4 mt-6">
                    <p><i class="fas fa-info-circle mr-2"></i> Khóa học bao gồm 5 chương chính với 25 bài giảng video và 100+ bài tập thực hành.</p>
                </div>
            </div> 
            
            <div>
                <div class="bg-gray-50 border border-gray-200 rounded-lg p-6 mt-6">
                    <h3 class="text-lg font-semibold mb-4">Lợi ích khi tham gia khóa học:</h3>
                    <ul class="list-disc pl-6 space-y-2">
                        <li>Hiểu sâu các khái niệm đại số cơ bản và nâng cao.</li>
                        <li>Phát triển tư duy logic và kỹ năng giải quyết vấn đề.</li>
                        <li>Chuẩn bị tốt cho các kỳ thi quan trọng.</li>
                        <li>Hỗ trợ học tập với tài liệu và bài giảng chất lượng cao.</li>
                    </ul>
                </div>
            </div>

            <!-- Package Offer -->
        <div class="bg-blue-50 border border-dashed rounded-lg p-6 text-center mb-6">
            <h3 class="text-lg font-bold mb-2">Học trọn gói cả năm chỉ với</h3>
            <button class="bg-blue-500 hover:bg-blue-700 text-white font-bold py-3 px-6 rounded-full text-lg transition">
                Học Ngay <i class="fas fa-arrow-right ml-2"></i>
            </button>
        </div>
        </div>

        <!-- Course Curriculum Content (Initially hidden) -->
        <div id="curriculum-content" class="tab-content card rounded-lg shadow-md p-6 mb-6 hidden">
            <h2 class="text-xl font-bold mb-6 pb-2 border-b">
                Đề cương khóa học
            </h2>

            <!-- Chapter 1 - Collapsible -->
            <div class="mb-6 border rounded-lg overflow-hidden">
                <button class="chapter-toggle w-full flex justify-between items-center p-4 hover:bg-gray-100 transition">
                    <h3 class="text-lg font-semibold chapter-title" data-chapter="1">
                        Chapter 1 | Ứng dụng đạo hàm để khảo sát & vẽ đồ thị hàm số
                    </h3>
                    <i class="fas fa-chevron-down transform transition-transform duration-300"></i>
                </button>
                
                <div class="chapter-content">
                    <!-- Theme Cards -->
                    <div class="space-y-4 p-4">
                        <!-- Theme 1 -->
                        <div class="theme-item mb-4 pl-3">
                            <button class="theme-toggle w-full text-left flex justify-between items-center p-2 rounded hover:bg-gray-100"
                                    data-theme="Sự đồng biến, nghịch biến của hàm số">
                                <div class="flex items-center">
                                    <span class="font-medium">Theme 1. Sự đồng biến, nghịch biến của hàm số</span>
                                </div>
                                <i class="fas fa-chevron-down text-xs transform transition-transform"></i>
                            </button>
                            
                            <div class="theme-detail mt-2 pl-2 hidden">
                                <div class="space-y-2 mt-2 w-full">
                                    <div class="flex items-center space-x-2 py-1 cursor-pointer video-item"
                                         data-video="rcfGl1e3KEg"
                                         data-type="main"
                                         data-title="Bài giảng chính: Sự đồng biến, nghịch biến của hàm số">
                                        <i class="fas fa-video text-green-600 w-6 text-center"></i>
                                        <span class="flex-1">Bài giảng chính</span>
                                    </div>
                                    <a href="https://drive.google.com/file/d/1a2b3c4d5e6f7g8h9i0j/view" class="flex items-center space-x-2 py-1 cursor-pointer pdf-item" data-video="rcfGl1e3KEg" target="_blank">
                                        <i class="far fa-file-pdf text-blue-600 w-6 text-center"></i>
                                        <span class="flex-1">Tài liệu PDF</span>
                                    </a>
                                </div>
                            </div>
                        </div>

                        <!-- Theme 2 -->
                        <div class="theme-item mb-4 pl-3">
                            <button class="theme-toggle w-full text-left flex justify-between items-center p-2 rounded hover:bg-gray-100"
                                    data-theme="Cực trị của hàm số">
                                <div class="flex items-center">
                                    <span class="font-medium">Theme 2. Cực trị của hàm số</span>
                                </div>
                                <i class="fas fa-chevron-down text-xs transform transition-transform"></i>
                            </button>
                            
                            <div class="theme-detail mt-2 pl-2 hidden">
                                <div class="space-y-2 mt-2 w-full">
                                    <div class="flex items-center space-x-2 py-1 cursor-pointer video-item"
                                         data-video="9bZkp7q19f0"
                                         data-type="main"
                                         data-title="Bài giảng chính: Cực trị của hàm số">
                                        <i class="fas fa-video text-green-600 w-6 text-center"></i>
                                        <span class="flex-1">Bài giảng chính</span>
                                    </div>
                                    <div class="flex items-center space-x-2 py-1 cursor-pointer video-item"
                                         data-video="kJQP7kiw5Fk"
                                         data-type="exercise"
                                         data-title="Chữa bài tập: Cực trị của hàm số">
                                        <i class="fas fa-tasks text-yellow-600 w-6 text-center"></i>
                                        <span class="flex-1">Chữa bài tập rèn luyện</span>
                                    </div>
                                    <a href="https://drive.google.com/file/d/2b3c4d5e6f7g8h9i0j1k/view" class="flex items-center space-x-2 py-1 cursor-pointer pdf-item" data-video="9bZkp7q19f0" target="_blank">
                                        <i class="far fa-file-pdf text-blue-600 w-6 text-center"></i>
                                        <span class="flex-1">Tài liệu PDF</span>
                                    </a>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Chapter 2 - Collapsible -->
            <div class="mb-6 border rounded-lg overflow-hidden">
                <button class="chapter-toggle w-full flex justify-between items-center p-4 hover:bg-gray-100 transition">
                    <h3 class="text-lg font-semibold chapter-title" data-chapter="2">
                        Chapter 2 | Hàm số lũy thừa, hàm số mũ và hàm số logarit
                    </h3>
                    <i class="fas fa-chevron-down transform transition-transform duration-300"></i>
                </button>
                
                <div class="chapter-content hidden">
                    <!-- Theme Cards -->
                    <div class="space-y-4 p-4">
                        <!-- Theme 1 -->
                        <div class="theme-item mb-4 pl-3">
                            <button class="theme-toggle w-full text-left flex justify-between items-center p-2 rounded hover:bg-gray-100"
                                    data-theme="Lũy thừa với số mũ hữu tỉ">
                                <div class="flex items-center">
                                    <span class="font-medium">Theme 1. Lũy thừa với số mũ hữu tỉ</span>
                                </div>
                                <i class="fas fa-chevron-down text-xs transform transition-transform"></i>
                            </button>
                            
                            <div class="theme-detail mt-2 pl-2 hidden">
                                <div class="space-y-2 mt-2 w-full">
                                    <div class="flex items-center space-x-2 py-1 cursor-pointer video-item"
                                         data-video="JGwWNGJdvx8"
                                         data-type="main"
                                         data-title="Bài giảng chính: Lũy thừa với số mũ hữu tỉ">
                                        <i class="fas fa-video text-green-600 w-6 text-center"></i>
                                        <span class="flex-1">Bài giảng chính</span>
                                    </div>
                                    <div class="flex items-center space-x-2 py-1 cursor-pointer video-item"
                                         data-video="OPf27YVjUYs"
                                         data-type="exercise"
                                         data-title="Chữa bài tập: Lũy thừa với số mũ hữu tỉ">
                                        <i class="fas fa-tasks text-yellow-600 w-6 text-center"></i>
                                        <span class="flex-1">Chữa bài tập rèn luyện</span>
                                    </div>
                                    <a href="https://drive.google.com/file/d/3c4d5e6f7g8h9i0j1k2l/view" class="flex items-center space-x-2 py-1 cursor-pointer pdf-item" data-video="JGwWNGJdvx8" target="_blank">
                                        <i class="far fa-file-pdf text-blue-600 w-6 text-center"></i>
                                        <span class="flex-1">Tài liệu PDF</span>
                                    </a>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Embedded JavaScript -->
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            // Tab switching functionality
            const tabs = document.querySelectorAll('.tab-button');
            const tabContents = document.querySelectorAll('.tab-content');
            const videoTypeSelector = document.getElementById('video-type-selector');
            const videoIframe = document.getElementById('course-video');
            const videoLoading = document.getElementById('video-loading');
            const mainLessonBtn = document.getElementById('main-lesson-btn');
            const exerciseBtn = document.getElementById('exercise-btn');
            const videoTypeTitle = document.getElementById('video-type-title');
            const headerOffset = 100;

            // List of free videos (first two videos)
            const freeVideos = ['rcfGl1e3KEg', '9bZkp7q19f0'];

            // Modal for key input
            const keyModal = document.createElement('div');
            keyModal.id = 'key-modal';
            keyModal.className = 'fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center hidden z-50';
            keyModal.innerHTML = `
                <div class="bg-white p-6 rounded-lg shadow-lg max-w-sm w-full">
                    <h2 class="text-xl font-bold mb-4">Yêu cầu nhập KEY</h2>
                    <p class="mb-4">Tài liệu hoặc video này yêu cầu KEY. Vui lòng nhập KEY để tiếp tục.</p>
                    <input type="text" id="key-input" class="w-full px-3 py-2 border rounded-lg mb-4 focus:outline-none focus:ring-2 focus:ring-blue-400" placeholder="Nhập KEY của bạn">
                    <div class="flex justify-end space-x-2">
                        <button id="cancel-key" class="px-4 py-2 rounded-lg border border-secondary bg-card hover:bg-hover-bg hover:bg-blue-400 text-text-color transition-colors duration-300">Hủy</button>
                        <button id="submit-key" class="px-4 py-2 rounded-lg border border-secondary bg-secondary text-accent hover:bg-blue-400 transition-colors duration-300"> Xác nhận</button>
                    </div>
                </div>
            `;
            document.body.appendChild(keyModal);

            // Modal control
            const showModal = () => keyModal.classList.remove('hidden');
            const hideModal = () => keyModal.classList.add('hidden');

            // Object to store the current video state
            let currentVideoState = {
                videoId: '',
                themeTitle: '',
                chapterTitle: '',
                videoType: 'main',
                isThemeSelected: false
            };

            // Function to show the intro video
            function showIntroVideo() {
                videoIframe.src = `https://www.youtube.com/embed/LWw1GYTMvjQ?autoplay=1&rel=0&modestbranding=1&controls=1&fs=1&disablekb=1&iv_load_policy=3`;
                document.getElementById('course-title').textContent = 'ĐẠI SỐ';
                document.getElementById('chapter-theme-title').classList.add('hidden');
                document.getElementById('video-type-title').classList.add('hidden');
                videoTypeSelector.classList.add('hidden');
            }

            // Function to update chapter height with smooth transition
            function updateChapterHeight(chapterContent) {
                if (chapterContent) {
                    chapterContent.style.transition = 'none';
                    chapterContent.style.maxHeight = chapterContent.scrollHeight + 'px';
                    setTimeout(() => {
                        chapterContent.style.transition = 'max-height 0.3s ease-out';
                    }, 10);
                }
            }

            // Tab switching functionality
            tabs.forEach(tab => {
                tab.addEventListener('click', function() {
                    // Reset styles for all tabs
                    tabs.forEach(t => {
                        t.classList.remove('text-blue-800', 'border-blue-800');
                        t.classList.add('text-gray-500', 'border-transparent');
                    });

                    // Highlight the clicked tab
                    this.classList.remove('text-gray-500', 'border-transparent');
                    this.classList.add('text-blue-800', 'border-blue-800');

                    // Hide all tab contents
                    tabContents.forEach(content => {
                        content.classList.add('hidden');
                    });

                    // Show the content corresponding to the clicked tab
                    const targetId = this.getAttribute('data-target');
                    const targetContent = document.getElementById(targetId);
                    if (targetContent) {
                        targetContent.classList.remove('hidden');
                    }

                    // If switching to description tab, show intro video and hide video type selector
                    if (targetId === 'description-content') {
                        videoTypeSelector.classList.add('hidden');
                        showIntroVideo();
                    } else if (targetId === 'curriculum-content') {
                        videoTypeSelector.classList.add('hidden'); // Hide on initial curriculum tab click
                        showIntroVideo(); // Reset to intro video
                    }
                });
            });

            // Chapter toggle functionality
            const chapterToggles = document.querySelectorAll('.chapter-toggle');
            chapterToggles.forEach(toggle => {
                toggle.addEventListener('click', function() {
                    const content = this.nextElementSibling;
                    const icon = this.querySelector('i');
                    if (content.classList.contains('hidden')) {
                        content.classList.remove('hidden');
                        icon.classList.add('rotate-180');
                        updateChapterHeight(content);
                    } else {
                        content.style.maxHeight = null;
                        setTimeout(() => {
                            content.classList.add('hidden');
                        }, 300);
                        icon.classList.remove('rotate-180');
                    }
                });
            });

            // Function to expand the parent chapter of a theme
            function expandParentChapter(themeElement) {
                const chapterContent = themeElement.closest('.chapter-content');
                if (chapterContent && chapterContent.classList.contains('hidden')) {
                    const chapterToggle = chapterContent.previousElementSibling;
                    chapterContent.classList.remove('hidden');
                    chapterToggle.querySelector('i').classList.add('rotate-180');
                    updateChapterHeight(chapterContent);
                }
            }

            // Function to check if video is free
            function isVideoFree(videoId) {
                return freeVideos.includes(videoId);
            }

            // Function to check if content is unlocked
            function isContentUnlocked() {
                return localStorage.getItem('contentUnlocked') === 'true';
            }

            // Function to unlock content
            function unlockContent() {
                localStorage.setItem('contentUnlocked', 'true');
            }

            // Function to change the video
            function changeVideo(videoId, themeTitle, chapterTitle, videoType, isThemeSelected) {
                try {
                    if (!isVideoFree(videoId) && !isContentUnlocked()) {
                        showModal();
                        document.getElementById('submit-key').onclick = () => {
                            const key = document.getElementById('key-input').value;
                            if (key === 'valid-key') { // Replace with actual key validation
                                unlockContent();
                                hideModal();
                                loadVideo(videoId, themeTitle, chapterTitle, videoType, isThemeSelected);
                            } else {
                                alert('KEY không hợp lệ!');
                            }
                        };
                        document.getElementById('cancel-key').onclick = hideModal;
                        return;
                    }
                    loadVideo(videoId, themeTitle, chapterTitle, videoType, isThemeSelected);
                } catch (error) {
                    console.error('Error changing video:', error);
                    videoLoading.classList.add('hidden');
                }
            }

            // Function to load the video
            function loadVideo(videoId, themeTitle, chapterTitle, videoType, isThemeSelected) {
                videoLoading.classList.remove('hidden');
                videoIframe.src = '';
                currentVideoState = { videoId, themeTitle, chapterTitle, videoType, isThemeSelected };
                if (isThemeSelected) {
                    videoTypeSelector.classList.remove('hidden'); // Show only when theme is selected
                    updateVideoTypeUI(videoType);
                    document.getElementById('course-title').textContent = themeTitle;
                    const chapterThemeTitle = document.getElementById('chapter-theme-title');
                    chapterThemeTitle.textContent = chapterTitle;
                    chapterThemeTitle.classList.remove('hidden');
                    videoTypeTitle.textContent = videoType === 'main' ? 'Bài giảng chính' : 'Chữa bài tập rèn luyện';
                    videoTypeTitle.classList.remove('hidden');
                } else {
                    videoTypeSelector.classList.add('hidden');
                    document.getElementById('chapter-theme-title').classList.add('hidden');
                    document.getElementById('video-type-title').classList.add('hidden');
                }
                videoIframe.src = `https://www.youtube.com/embed/${videoId}?autoplay=1&rel=0&modestbranding=1&controls=1&fs=1&disablekb=1&iv_load_policy=3`;
                videoIframe.onload = function() {
                    videoLoading.classList.add('hidden');
                    if (isThemeSelected) {
                        setTimeout(() => {
                            window.scrollTo({ top: 0, behavior: 'smooth' });
                        }, 300);
                    }
                };
            }

            // Function to update the video type UI
            function updateVideoTypeUI(videoType) {
                if (videoType === 'main') {
                    mainLessonBtn.classList.add('active');
                    exerciseBtn.classList.remove('active');
                } else {
                    mainLessonBtn.classList.remove('active');
                    exerciseBtn.classList.add('active');
                }
            }

            // Theme toggle functionality
            const themeToggles = document.querySelectorAll('.theme-toggle');
            themeToggles.forEach(toggle => {
                if (toggle.id !== 'theme-toggle') {
                    toggle.addEventListener('click', function(event) {
                        const clickedElement = event.target;
                        const themeItem = this.closest('.theme-item');
                        const detail = themeItem.querySelector('.theme-detail');
                        const icon = this.querySelector('i');
                        const chapterContent = themeItem.closest('.chapter-content');
                        expandParentChapter(themeItem);
                        if (clickedElement === this || clickedElement.closest('span') === this.querySelector('span')) {
                            const themeTitle = this.getAttribute('data-theme');
                            const chapterTitle = this.closest('.chapter-content').previousElementSibling.querySelector('.chapter-title').textContent;
                            const mainVideoItem = themeItem.querySelector('.video-item[data-type="main"]');
                            if (mainVideoItem) {
                                const videoId = mainVideoItem.getAttribute('data-video');
                                if (detail.classList.contains('hidden')) {
                                    detail.classList.remove('hidden');
                                    icon.classList.add('rotate-180');
                                    detail.style.maxHeight = detail.scrollHeight + 'px';
                                    updateChapterHeight(chapterContent);
                                    setTimeout(() => {
                                        changeVideo(videoId, themeTitle, chapterTitle, 'main', true);
                                    }, 100);
                                } else {
                                    changeVideo(videoId, themeTitle, chapterTitle, 'main', true);
                                }
                            }
                        } else {
                            if (detail.classList.contains('hidden')) {
                                detail.classList.remove('hidden');
                                icon.classList.add('rotate-180');
                                detail.style.maxHeight = detail.scrollHeight + 'px';
                                updateChapterHeight(chapterContent);
                                setTimeout(() => {
                                    const elementPosition = this.getBoundingClientRect().top;
                                    const offsetPosition = elementPosition + window.pageYOffset - headerOffset;
                                    window.scrollTo({ top: offsetPosition, behavior: 'smooth' });
                                }, 100);
                            } else {
                                detail.style.maxHeight = null;
                                setTimeout(() => {
                                    detail.classList.add('hidden');
                                    icon.classList.remove('rotate-180');
                                    updateChapterHeight(chapterContent);
                                }, 300);
                            }
                        }
                    });
                }
            });

            // Video item click handler
            document.querySelectorAll('.video-item').forEach(item => {
                item.addEventListener('click', function() {
                    const videoId = this.getAttribute('data-video');
                    const videoType = this.getAttribute('data-type');
                    const themeItem = this.closest('.theme-item');
                    const themeTitle = themeItem.querySelector('.theme-toggle').getAttribute('data-theme');
                    const chapterTitle = themeItem.closest('.chapter-content').previousElementSibling.querySelector('.chapter-title').textContent;
                    const chapterContent = themeItem.closest('.chapter-content');
                    const detail = themeItem.querySelector('.theme-detail');
                    if (chapterContent.classList.contains('hidden')) {
                        chapterContent.classList.remove('hidden');
                        chapterContent.previousElementSibling.querySelector('i').classList.add('rotate-180');
                        updateChapterHeight(chapterContent);
                    }
                    if (detail.classList.contains('hidden')) {
                        detail.classList.remove('hidden');
                        themeItem.querySelector('.theme-toggle i').classList.add('rotate-180');
                        detail.style.maxHeight = detail.scrollHeight + 'px';
                        updateChapterHeight(chapterContent);
                    }
                    changeVideo(videoId, themeTitle, chapterTitle, videoType, true);
                });
            });

            // PDF item click handler
            document.querySelectorAll('.pdf-item').forEach(item => {
                item.addEventListener('click', function(event) {
                    const videoId = this.getAttribute('data-video');
                    const pdfUrl = this.getAttribute('href');
                    if (!isVideoFree(videoId) && !isContentUnlocked()) {
                        event.preventDefault();
                        showModal();
                        document.getElementById('submit-key').onclick = () => {
                            const key = document.getElementById('key-input').value;
                            if (key === 'valid-key') { // Replace with actual key validation
                                unlockContent();
                                hideModal();
                                window.open(pdfUrl, '_blank');
                            } else {
                                alert('KEY không hợp lệ!');
                            }
                        };
                        document.getElementById('cancel-key').onclick = hideModal;
                    }
                });
            });

            // Handle main lesson button click
            mainLessonBtn.addEventListener('click', function() {
                if (currentVideoState.videoId && currentVideoState.isThemeSelected) {
                    const currentTheme = document.querySelector(`.theme-toggle[data-theme="${currentVideoState.themeTitle}"]`);
                    if (currentTheme) {
                        const themeItem = currentTheme.closest('.theme-item');
                        const mainVideoItem = themeItem.querySelector('.video-item[data-type="main"]');
                        if (mainVideoItem) {
                            const videoId = mainVideoItem.getAttribute('data-video');
                            changeVideo(videoId, currentVideoState.themeTitle, currentVideoState.chapterTitle, 'main', true);
                        }
                    }
                }
            });

            // Handle exercise button click
            exerciseBtn.addEventListener('click', function() {
                if (currentVideoState.videoId && currentVideoState.isThemeSelected) {
                    const currentTheme = document.querySelector(`.theme-toggle[data-theme="${currentVideoState.themeTitle}"]`);
                    if (currentTheme) {
                        const themeItem = currentTheme.closest('.theme-item');
                        const exerciseVideoItem = themeItem.querySelector('.video-item[data-type="exercise"]');
                        if (exerciseVideoItem) {
                            const videoId = exerciseVideoItem.getAttribute('data-video');
                            changeVideo(videoId, currentVideoState.themeTitle, currentVideoState.chapterTitle, 'exercise', true);
                        }
                    }
                }
            });

            // Initialize first chapter
            const firstChapter = document.querySelector('.chapter-content');
            if (firstChapter) {
                firstChapter.classList.add('hidden');
                firstChapter.style.maxHeight = null;
                document.querySelector('.chapter-toggle i').classList.remove('rotate-180');
            }

            // Show the intro video
            showIntroVideo();
        });
        
    </script>

    <!-- Nhúng footer.html -->
    <iframe src="footer.html" class="w-full border-0" style="min-height: 250px;" scrolling="no" onload="this.style.height=(this.contentWindow.document.body.scrollHeight)+'px';"></iframe>

    <!-- JavaScript for Theme Toggle, Scroll to Top, Animations, and Search -->
    <script src="main.js"></script>
</body>
</html>